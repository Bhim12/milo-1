// Tue, 06 Feb 2024 14:20:14 GMT
import{LitElement as D}from"/libs/deps/lit-all.min.js";var p="merch",v="hidden",E="wcms:commerce:ready",C="wcms-commerce";var A=(o,t,{bubbles:r=!0,cancelable:e,composed:n,detail:s}={})=>window.setTimeout(()=>o?.dispatchEvent(new CustomEvent(t,{bubbles:r,cancelable:e,composed:n,detail:s})));function T(...o){let[t,...r]=o;if(!t)return null;let e=t.parentElement;if(!r.length)return e;for(;e;){if(r.every(n=>e.contains(n)))return e;e=e.parentElement}return null}var x=(o,t)=>o.filter(r=>r).map(r=>r.replace(/\W+/g,t)).join(t),k=(...o)=>`${p}-${x(o,"-")}`,P=(...o)=>`${p}:${x(o,":")}`;function y(o,t=()=>!0){let r=0;for(let e of o.values())e.container?.classList.toggle(v,!t(e,r++))}var f="failed",u="pending",a="resolved",d=class{#t;#n={};#e;#s;constructor(t,{cssPrefix:r="component",eventOptions:e,eventPrefix:n="component"}={}){this.#s=t;let s=this.#n;s.cssClassNames={},s.eventOptions=e,s.eventTypeNames={};for(let i of[f,u,a])s.cssClassNames[i]=k(r,i),s.eventTypeNames[i]=P(n,i);this.init()}#r(t){let{cssClassNames:r,eventOptions:e,eventTypeNames:n}=this.#n;[f,u,a].forEach(s=>{this.#s.classList.toggle(r[s],s===this.#e)}),A(this.#s,n[this.#e],{...e,detail:t})}get error(){return this.#t}get promise(){return new Promise((t,r)=>{this.subscribe(t,r)})}get state(){return this.#e}init(){return this.#e!==u?(this.#e=u,this.#t=void 0,this.#r(),!0):!1}reject(t){return this.#e!==u?!1:(this.#t=t,this.#e=f,this.#r(),!0)}async resolve(t){return this.#e!==u?!1:(t&&await t,this.#e=a,this.#r(),!0)}subscribe(t,r,e){let{eventTypeNames:n}=this.#n,s=this.#s,i=!1,c=m=>{e&&i||(i=!0,r(m.detail))},l=m=>{e&&i||(i=!0,t(m.detail))},h=this.#e;if(f===h?r?.(this.#t):a===h&&t(this.#s),i)return()=>{};let N=e?{once:!0}:void 0;return s.addEventListener(n[a],l,N),r&&s.addEventListener(n[f],c,N),()=>{s.removeEventListener(n[a],l),r&&s.removeEventListener(n[f],c)}}static FAILED=f;static PENDING=u;static RESOLVED=a};var w="UNKNOWN";async function S(o,t,r){let e=new Map;await Promise.allSettled(r.map(s=>s.onceSettled()));let n=0;for(let s of r){if(!t.filterPlaceholder(s,n++))continue;let i=s?.value??[];for(let{planType:c=w}of i){let l=e.get(c)??{checkoutLinks:[],inlinePrices:[],planType:c,get container(){let h=T(...l.checkoutLinks,...l.inlinePrices);if(h?.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_CONTAINS)return h}};s.isCheckoutLink?l.checkoutLinks.push(s):s.isInlinePrice&&l.inlinePrices.push(s),e.set(c,l)}}n=0;for(let s of e.values())t.filterOffer(s,n++)||e.delete(s.planType);return e}function O(o,{once:t=!1}={}){let{head:r}=document,e=null;function n(){let s=r.querySelector(C);s!==e&&(e=s,s&&o(s))}return r.addEventListener(E,n,{once:t}),window.setTimeout(n),()=>r.removeEventListener(E,n)}function L(o,t){return class extends o{#t=new d(this,{cssPrefix:t,eventPrefix:t});#n;#e;#s;#r;#i;#o;#c(e){let{offers:n}=this;if(!n)return;let s=n.get(e)??n.get(e?.planType);if(s===this.#o)return;let i=this.#o;this.#o=s,this.requestUpdate("selected",i),this.log?.debug("Selected:",{selected:this.selected?.planType,element:this})}get commerce(){return this.#n}get control(){return this.#t}get log(){return this.#s}get offers(){return this.#r}get resolveComplete(){return this.#t.promise}get selected(){return this.#o}set selected(e){this.#i=e,this.#c(e)}connectedCallback(){super.connectedCallback(),this.#e=O(e=>{let n=[this.#n,this.#s,this.#r];this.#n=e,this.#s=e.Log.module(t),this.#r=void 0,this.#s.debug("Connected:",{element:this}),this.requestUpdate("commerce",n[0]),this.requestUpdate("log",n[1]),this.requestUpdate("offers",n[2])})}disconnectedCallback(){this.#s.debug("Disconnected:",{element:this}),super.disconnectedCallback(),this.#e?.()}filterOffer(e,n){return!0}filterPlaceholder(e,n){return!0}async discoverOffers(e){this.#t.init();let n=[],{commerce:s}=this;if(s){let{CheckoutLink:c,InlinePrice:l}=s;n.push(...c.getCheckoutLinks(e),...l.getInlinePrices(e)),this.log.debug("Discovering offers:",{container:e,element:this})}let i=this.#r;try{let c=await S(e,this,n);this.#r=c,this.requestUpdate("offers",i),this.#c(this.#i)}catch(c){this.#t.reject(c)}}}}var _="merch-stock",g=class extends L(D,"merch-stock"){#t(){let{offers:t,selected:r}=this;t&&(y(this.offers,e=>e===r),this.control.resolve())}get selected(){return super.selected}set selected(t){super.selected=t}createRenderRoot(){return this}updated(t){super.updated(t);let{commerce:r}=this;r&&t.has("commerce")&&this.discoverOffers(this),(t.has("offers")||t.has("selected"))&&this.#t()}};window.customElements.define(_,g);export{g as Stock};
//# sourceMappingURL=merch-stock.js.map
